<!DOCTYPE html>
<html lang="es">
<head>
    <!-- Configuración fundamental de la página -->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mi Proyecto Web - Título</title>

    <!-- Carga del CDN de Tailwind CSS para un estilizado rápido y responsivo -->
    <script src="https://cdn.tailwindcss.com"></script>

    <style>
        /* Estilos personalizados */
        body {
            font-family: 'Inter', sans-serif;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }
        main {
            flex-grow: 1;
        }
        .slider-container {
            overflow: hidden;
            width: 100%;
        }
        .slider-wrapper {
            display: flex;
            transition: transform 0.5s ease-in-out;
        }
        .slider-item {
            min-width: 50%; 
            flex-shrink: 0;
            padding: 0 8px;
            box-sizing: border-box;
        }
        .btn {
            display: inline-block;
            text-align: center;
            text-decoration: none;
        }
        /* Estilos para el Modal de Reseñas (Ventana Emergente) */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7); /* Fondo oscuro semitransparente */
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            transition: opacity 0.3s ease;
        }
        .modal-content {
            background-color: white;
            padding: 2rem;
            border-radius: 1rem;
            max-width: 90%;
            width: 450px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.5);
            position: relative;
            transform: scale(0.9);
            transition: transform 0.3s ease;
        }
        .modal.is-visible .modal-content {
            transform: scale(1);
        }
        .hidden {
            display: none;
        }
    </style>
</head>
<body class="bg-gray-50 text-gray-800 antialiased">

    <!-- 1. ENCABEZADO (HEADER) -->
    <header class="bg-white shadow-md">
        <nav class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4 flex justify-between items-center">
            <!-- Logo o Nombre del Sitio -->
            <a href="#" class="text-xl font-bold text-indigo-600 hover:text-indigo-800 transition duration-150">
                Tu Marca
            </a>
            
            <!-- Elementos de Navegación (Ej. para desktop) -->
            <div class="hidden md:flex space-x-6 items-center">
                <a href="#inicio" class="text-gray-600 hover:text-indigo-600 font-medium transition duration-150">Inicio</a>
                <a href="#reseñas" class="text-gray-600 hover:text-indigo-600 font-medium transition duration-150">Ver Reseñas</a>
                <!-- Botón de CTA para abrir el modal -->
                <button id="open-review-modal-btn-nav" class="btn px-4 py-2 bg-indigo-600 text-white font-semibold rounded-lg shadow-md hover:bg-indigo-700 transition duration-300 text-sm">
                    Dejar Reseña
                </button>
                <!-- ENLACE A LA PÁGINA DE CONTACTO -->
                <a href="contacto.html" class="text-gray-600 hover:text-indigo-600 font-medium transition duration-150">Contacto</a>
            </div>

            <!-- Botón de Menú (Ej. para mobile/tablet) -->
            <button class="md:hidden p-2 rounded-md hover:bg-gray-100 transition duration-150" id="mobile-menu-button">
                <!-- Icono de Menú (ej. un SVG o un simple '☰') -->
                <svg class="w-6 h-6 text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16m-7 6h7"></path></svg>
            </button>
        </nav>

        <!-- Menú Móvil Desplegable (Inicialmente oculto) -->
        <div class="md:hidden hidden bg-white shadow-lg" id="mobile-menu">
            <a href="#inicio" class="block px-4 py-2 text-sm text-gray-700 hover:bg-indigo-50">Inicio</a>
            <a href="#reseñas" class="block px-4 py-2 text-sm text-gray-700 hover:bg-indigo-50">Ver Reseñas</a>
            <button id="open-review-modal-btn-mobile" class="w-full text-left px-4 py-2 text-sm text-indigo-600 hover:bg-indigo-50 border-t border-gray-100">Dejar Reseña</button>
            <!-- ENLACE A LA PÁGINA DE CONTACTO -->
            <a href="contacto.html" class="block px-4 py-2 text-sm text-gray-700 hover:bg-indigo-50">Contacto</a>
        </div>
    </header>

    <!-- MODAL (Ventana Emergente) para el Formulario de Reseñas -->
    <div id="review-modal" class="modal hidden">
        <div class="modal-content">
            <button id="close-review-modal-btn" class="absolute top-3 right-3 p-2 text-gray-500 hover:text-gray-800 transition">
                <!-- Icono de Cierre (X) -->
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
            </button>

            <h3 class="text-2xl font-semibold text-indigo-600 mb-6 border-b pb-2">Comparte tu Opinión</h3>
            <form id="review-form">
                <!-- Rating Input -->
                <div class="mb-4">
                    <label for="rating" class="block text-sm font-medium text-gray-700 mb-2">Tu Calificación (1-5 Estrellas)</label>
                    <select id="rating" name="rating" required class="w-full p-2 border border-gray-300 rounded-lg focus:ring-indigo-500 focus:border-indigo-500 shadow-sm">
                        <option value="5">5 Estrellas (Excelente)</option>
                        <option value="4">4 Estrellas</option>
                        <option value="3">3 Estrellas</option>
                        <option value="2">2 Estrellas</option>
                        <option value="1">1 Estrella (Malo)</option>
                    </select>
                </div>

                <!-- Review Text -->
                <div class="mb-4">
                    <label for="review-text" class="block text-sm font-medium text-gray-700 mb-2">Tu Opinión</label>
                    <textarea id="review-text" name="text" rows="3" required class="w-full p-2 border border-gray-300 rounded-lg focus:ring-indigo-500 focus:border-indigo-500 shadow-sm" placeholder="Escribe tu experiencia con nuestros productos o servicio..."></textarea>
                </div>

                <!-- Author Name -->
                <div class="mb-6">
                    <label for="author-name" class="block text-sm font-medium text-gray-700 mb-2">Tu Nombre (o Alias)</label>
                    <input type="text" id="author-name" name="author" required class="w-full p-2 border border-gray-300 rounded-lg focus:ring-indigo-500 focus:border-indigo-500 shadow-sm" placeholder="Ej: Juan D. o Cliente Satisfecho">
                </div>

                <!-- Submit Button -->
                <button type="submit" id="submit-review-btn" class="w-full px-4 py-2 bg-indigo-600 text-white font-semibold rounded-lg shadow-md hover:bg-indigo-700 transition duration-300 disabled:bg-indigo-400">
                    Enviar Reseña
                </button>
                <p id="review-message" class="mt-3 text-center text-sm text-green-600 hidden"></p>
            </form>
        </div>
    </div>
    <!-- FIN MODAL -->


    <!-- 2. CONTENIDO PRINCIPAL (MAIN) -->
    <main>
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-12">
            
            <!-- SECCIÓN DE BIENVENIDA -->
            <section id="inicio" class="text-center mb-16 bg-white p-8 rounded-xl shadow-lg">
                <h1 class="text-4xl sm:text-5xl font-extrabold text-indigo-600 mb-4">
                    DOTACIONES PANTHER
                </h1>
                <p class="text-lg text-gray-600 max-w-2xl mx-auto mb-6">
                    Somos expertos en todo lo relacoinado a uniformes, pijamas, Dotaciones médicas, empresariales y más.
                    Pregunta por lo que deseas para ti o tu empresa.
                </p>
                
                <!-- Contenedor de Botones (AHORA SON ENLACES <a>) -->
                <div class="flex flex-col sm:flex-row justify-center space-y-4 sm:space-y-0 sm:space-x-4">
                    <!-- Botón 1: DOTACIONES MÉDICAS (CTA Primario) -->
                    
                    <a href="dotaciones_medicas.html" 
                    class="btn px-6 py-3 border border-indigo-600 font-semibold rounded-lg shadow-md hover:bg-indigo-50 transition duration-300">
                     Dotaciones Médicas
                    </a>


                    <!--<a href="#" target="_blank" class="btn px-6 py-3 border border-indigo-600 font-semibold rounded-lg shadow-md hover:bg-indigo-50 transition duration-300">
                        Dotaciones Médicas
                    </a>..>
                    <!-- Botón 2: UNIFORMES -->
                     <a href="uniformes.html" class="btn px-6 py-3 border border-indigo-600 text-indigo-600 font-semibold rounded-lg shadow-md hover:bg-indigo-50 transition duration-300">
    Uniformes
</a>

                     <!--<a href="uniformes.html" target="_blank" 
   class="btn px-6 py-3 border border-indigo-600 text-indigo-600 font-semibold rounded-lg shadow-md hover:bg-indigo-50 transition duration-300">
    Uniformes
</a> -->

                    <!--<a href="#" target="_blank" class="btn px-6 py-3 border border-indigo-600 text-indigo-600 font-semibold rounded-lg shadow-md hover:bg-indigo-50 transition duration-300">
                        Uniformes
                    </a> -->
                    <!-- Botón 3: CONTACTO Y VENTAS -->
                    <!-- ENLACE ACTUALIZADO: apunta al nuevo archivo contacto.html -->
                    <a href="contacto.html" class="btn px-6 py-3 bg-gray-200 text-gray-700 font-semibold rounded-lg shadow-md hover:bg-gray-300 transition duration-300">
                        Contacto y Ventas
                    </a>
                </div>
            </section>
            
            <!-- SECCIÓN DE CARRUSEL/SLIDER DE IMÁGENES -->
            <section id="carrusel" class="mb-16">
                <h2 class="text-3xl font-bold text-center text-gray-800 mb-6">Nuestros Proyectos Recientes</h2>
                
                <div class="bg-white p-4 rounded-xl shadow-lg relative" id="slider-main-container">
                    <div class="slider-container rounded-lg">
                        <!-- Wrapper para las imágenes -->
                        <div class="slider-wrapper" id="slider-wrapper">
                            
                            <!-- Imagen 1 - tamaño 300x250 -->
                            <div class="slider-item flex justify-center items-center bg-gray-100 rounded-lg">
                                <img src="imgs/unf1.jpg" 
                                     alt="Proyecto 1"
                                     class="w-[300px] h-[250px] rounded-lg object-cover">
                                    </div>
                            <!-- Imagen 2 - tamaño 300x250 -->
                            <div class="slider-item flex justify-center items-center bg-gray-100 rounded-lg">
                                <img src="imgs/unf10.jpg" 
                                     alt="Proyecto 2"
                                     class="w-[300px] h-[250px] rounded-lg object-cover">
                            </div>
                            <!-- Imagen 3 - tamaño 300x250 -->
                            <div class="slider-item flex justify-center items-center bg-gray-100 rounded-lg">
                                <img src="imgs/unf8.jpg" 
                                     alt="Proyecto 3"
                                     class="w-[300px] h-[250px] rounded-lg object-cover">
                            </div>
                            <!-- Imagen 4 - tamaño 300x250 -->
                            <div class="slider-item flex justify-center items-center bg-gray-100 rounded-lg">
                                <img src="imgs/dot10.jpg" 
                                     alt="Proyecto 4"
                                     class="w-[300px] h-[250px] rounded-lg object-cover">
                            </div>
                            <!-- Imagen 5 - tamaño 300x250 -->
                            <div class="slider-item flex justify-center items-center bg-gray-100 rounded-lg">
                                <img src="imgs/unf4.jpg" 
                                     alt="Proyecto 5" 
                                     class="w-[300px] h-[250px] rounded-lg object-cover">
                            </div>
                            <!-- Imagen 6 - tamaño 300x250 -->
                            <div class="slider-item flex justify-center items-center bg-gray-100 rounded-lg">
                                <img src="imgs/unf4.jpg" 
                                     alt="Proyecto 6" 
                                     class="w-[300px] h-[250px] rounded-lg object-cover">
                            </div>
                            <!-- Imagen 7 - tamaño 300x250 -->
                            <div class="slider-item flex justify-center items-center bg-gray-100 rounded-lg">
                                <img src="imgs/dot6.jpg" 
                                     alt="Proyecto 7" 
                                     class="w-[300px] h-[250px] rounded-lg object-cover">
                            </div>
                        </div>
                    </div>
                    
                    <!-- Controles de Navegación (Flechas) -->
                    <button id="prev-btn" class="absolute top-1/2 left-4 transform -translate-y-1/2 bg-black bg-opacity-50 text-white p-3 rounded-full hover:bg-opacity-75 transition duration-300 z-10">
                        <!-- Flecha izquierda SVG -->
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path></svg>
                    </button>
                    <button id="next-btn" class="absolute top-1/2 right-4 transform -translate-y-1/2 bg-black bg-opacity-50 text-white p-3 rounded-full hover:bg-opacity-75 transition duration-300 z-10">
                        <!-- Flecha derecha SVG -->
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path></svg>
                    </button>

                    <!-- Indicadores de Posición (Dots) -->
                    <div id="slider-dots" class="flex justify-center mt-4 space-x-2">
                        <!-- Los puntos se insertarán aquí con JS -->
                    </div>
                </div>
            </section>


            <!-- SECCIÓN DE RESEÑAS DE CLIENTES -->
            <section id="reseñas" class="mb-16">
                <h2 class="text-3xl font-bold text-center text-gray-800 mb-8">Lo que Dicen Nuestros Clientes</h2>
                
                <!-- Botón CTA para abrir el formulario modal -->
                <div class="text-center mb-10" id="reviews-cta">
                    <button id="open-review-modal-btn" class="px-8 py-3 bg-indigo-500 text-white font-bold rounded-lg shadow-xl hover:bg-indigo-600 transition duration-300 transform hover:scale-105">
                        ¡Escribe una Reseña Ahora!
                    </button>
                    <p id="auth-status" class="mt-2 text-sm text-gray-500 hidden"></p>
                </div>


                <!-- CONTENEDOR DINÁMICO DE RESEÑAS -->
                <div class="grid md:grid-cols-3 gap-8" id="reviews-container">
                    <!-- Las reseñas se cargarán aquí dinámicamente desde Firestore -->
                    <p class="col-span-3 text-center text-gray-500" id="loading-reviews">Cargando reseñas...</p>
                </div>
            </section>
            
            <!-- NOTA: La sección de contacto detallada fue movida a contacto.html -->

        </div>
    </main>

    <!-- 3. PIE DE PÁGINA (FOOTER) -->
    <footer class="bg-gray-800 text-white mt-auto">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8 text-center">
            <p class="text-sm">&copy; 2025 Mi Proyecto Web. Todos los derechos reservados.</p>
            <div class="mt-2 space-x-4">
                <a href="#" class="text-gray-400 hover:text-white transition duration-150 text-sm">Política de Privacidad</a>
                <span class="text-gray-600">|</span>
                <a href="#" class="text-gray-400 hover:text-white transition duration-150 text-sm">Términos de Uso</a>
            </div>
        </div>
    </footer>

    <!-- 4. LÓGICA DE JAVASCRIPT (FIREBASE Y MODAL) -->
    <script type="module">
        // Importaciones de Firebase SDK (versión 11.x)
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, collection, addDoc, onSnapshot, serverTimestamp, setLogLevel } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // Variables globales (proporcionadas por el entorno)
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
        const firebaseConfig = typeof __firebase_config !== 'undefined' ? JSON.parse(__firebase_config) : {};
        const initialAuthToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null;

        let db;
        let auth;
        let isAuthReady = false;

        // Elementos del DOM para las reseñas
        const reviewsContainer = document.getElementById('reviews-container');
        const reviewModal = document.getElementById('review-modal');
        const reviewForm = document.getElementById('review-form');
        const submitBtn = document.getElementById('submit-review-btn');
        const reviewMessage = document.getElementById('review-message');
        const loadingReviews = document.getElementById('loading-reviews');
        const authStatus = document.getElementById('auth-status');
        
        // Botones para abrir y cerrar el modal
        const openModalBtn = document.getElementById('open-review-modal-btn');
        const openModalBtnNav = document.getElementById('open-review-modal-btn-nav');
        const openModalBtnMobile = document.getElementById('open-review-modal-btn-mobile');
        const closeModalBtn = document.getElementById('close-review-modal-btn');

        // Función para manejar el Modal (Ventana Emergente)
        const showModal = () => {
            reviewModal.classList.remove('hidden');
            // Agrega una clase para la transición de escala si lo deseas
            setTimeout(() => reviewModal.classList.add('is-visible'), 10);
        };
        
        const closeModal = () => {
            // Remueve la clase de transición
            reviewModal.classList.remove('is-visible');
            // Oculta completamente después de la transición
            setTimeout(() => {
                reviewModal.classList.add('hidden');
                reviewMessage.classList.add('hidden'); // Ocultar mensaje de éxito/error al cerrar
            }, 300); 
            reviewForm.reset(); // Resetear el formulario al cerrar
        };

        // Función para inicializar Firebase y autenticar al usuario
        async function initializeFirebase() {
            try {
                const app = initializeApp(firebaseConfig);
                db = getFirestore(app);
                auth = getAuth(app);

                // Configurar el nivel de log para depuración (opcional)
                // setLogLevel('Debug');

                if (initialAuthToken) {
                    await signInWithCustomToken(auth, initialAuthToken);
                } else {
                    await signInAnonymously(auth);
                }
                
                onAuthStateChanged(auth, (user) => {
                    if (user) {
                        console.log("Usuario autenticado:", user.uid);
                        isAuthReady = true;
                        loadReviews(); // Cargar reseñas solo después de la autenticación
                    } else {
                        console.error("No se pudo autenticar al usuario.");
                        authStatus.textContent = `Estado: Sin autenticar. Las reseñas serán anónimas.`;
                        authStatus.classList.remove('hidden');
                    }
                });

            } catch (error) {
                console.error("Error al inicializar Firebase o autenticar:", error);
                authStatus.textContent = `Error de Firebase. No se pueden cargar ni enviar reseñas.`;
                authStatus.classList.remove('hidden');
            }
        }

        // Función de utilidad para renderizar estrellas (ej. ★★★★★)
        function renderStars(rating) {
            const fullStar = '★';
            const emptyStar = '★';
            
            let html = '';
            // Asegurarse de que el rating es un número entero
            const numRating = Math.round(rating); 

            for (let i = 1; i <= 5; i++) {
                if (i <= numRating) {
                    html += `<span class="text-yellow-500">${fullStar}</span>`;
                } else {
                    html += `<span class="text-gray-300">${emptyStar}</span>`;
                }
            }
            return html;
        }

        // Función para renderizar una sola tarjeta de reseña
        function renderReviewCard(review) {
            const date = review.timestamp?.toDate ? review.timestamp.toDate().toLocaleDateString('es-ES') : 'Fecha Desconocida';
            
            const card = document.createElement('div');
            card.className = 'bg-white p-6 rounded-xl shadow-lg border border-gray-100 transform hover:scale-[1.02] transition duration-300';
            
            card.innerHTML = `
                <div class="flex items-center mb-3 text-xl">
                    ${renderStars(review.rating)}
                </div>
                <p class="text-gray-700 italic mb-4">
                    "${review.text}"
                </p>
                <p class="text-sm font-semibold text-gray-900 border-t pt-3 mt-3">
                    — ${review.author} <span class="text-xs text-gray-500">(${date})</span>
                </p>
            `;
            
            return card;
        }

        // Función para cargar reseñas en tiempo real desde Firestore
        function loadReviews() {
            if (!db) return; // Asegurar que db esté inicializado

            // Path de la colección de reseñas públicas
            const reviewsColRef = collection(db, `artifacts/${appId}/public/data/reviews`);
            
            // onSnapshot crea una escucha en tiempo real
            onSnapshot(reviewsColRef, (snapshot) => {
                const reviews = [];
                snapshot.forEach(doc => {
                    reviews.push({ id: doc.id, ...doc.data() });
                });
                
                // Ordenar por timestamp de forma descendente (más recientes primero)
                reviews.sort((a, b) => {
                    const timeA = a.timestamp?.seconds || 0;
                    const timeB = b.timestamp?.seconds || 0;
                    return timeB - timeA;
                });
                
                // Limpiar y renderizar
                reviewsContainer.innerHTML = ''; 
                
                if (reviews.length === 0) {
                    reviewsContainer.innerHTML = '<p class="col-span-3 text-center text-gray-500">Aún no hay reseñas. ¡Sé el primero en dejar una!</p>';
                } else {
                    reviews.forEach(review => {
                        reviewsContainer.appendChild(renderReviewCard(review));
                    });
                }
            }, (error) => {
                console.error("Error al escuchar reseñas:", error);
                reviewsContainer.innerHTML = '<p class="col-span-3 text-center text-red-500">Error al cargar las reseñas.</p>';
            });
        }
        
        // Función para manejar el envío del formulario
        async function handleReviewSubmit(e) {
            e.preventDefault();
            
            if (!isAuthReady || !db) {
                console.error("Firebase no está listo.");
                return;
            }

            submitBtn.disabled = true;
            submitBtn.textContent = 'Enviando...';
            reviewMessage.textContent = '';
            reviewMessage.classList.add('hidden');

            const formData = new FormData(reviewForm);
            
            const newReview = {
                rating: parseInt(formData.get('rating')),
                text: formData.get('text').trim(),
                author: formData.get('author').trim() || 'Anónimo',
                timestamp: serverTimestamp(), // Marca de tiempo del servidor
                userId: auth.currentUser?.uid || 'anonymous' // ID del usuario para trazabilidad
            };

            try {
                const reviewsColRef = collection(db, `artifacts/${appId}/public/data/reviews`);
                await addDoc(reviewsColRef, newReview);
                
                // Mostrar mensaje de éxito
                reviewMessage.textContent = '¡Reseña enviada con éxito! Cerrando en 3 segundos...';
                reviewMessage.classList.remove('hidden', 'text-red-600');
                reviewMessage.classList.add('text-green-600');
                
                // Cerrar el modal después de 3 segundos (como solicitaste)
                setTimeout(closeModal, 3000); 

            } catch (error) {
                console.error("Error al guardar la reseña:", error);
                reviewMessage.textContent = 'Error al enviar la reseña. Inténtalo de nuevo.';
                reviewMessage.classList.remove('hidden', 'text-green-600');
                reviewMessage.classList.add('text-red-600');
            } finally {
                submitBtn.disabled = false;
                submitBtn.textContent = 'Enviar Reseña';
            }
        }
        
        // Lógica del Carrusel (Mantenida)
        function initCarousel() {
            const sliderWrapper = document.getElementById('slider-wrapper');
            const prevBtn = document.getElementById('prev-btn');
            const nextBtn = document.getElementById('next-btn');
            const sliderDotsContainer = document.getElementById('slider-dots');
            const sliderMainContainer = document.getElementById('slider-main-container'); 
            
            const slides = document.querySelectorAll('.slider-item');
            const totalSlides = slides.length;
            let currentIndex = 0; 
            let intervalId; 

            // Se muestran 2 slides a la vez en desktop, pero sólo 1 en mobile. 
            const step = 1; 
            
            const updateSlider = () => {
                const viewportWidth = window.innerWidth;
                let itemWidthPercentage = viewportWidth < 768 ? 100 : 50; 
                
                const visibleItems = viewportWidth < 768 ? 1 : 2;
                const newMaxIndex = totalSlides > visibleItems ? totalSlides - visibleItems : 0;

                if (currentIndex > newMaxIndex) currentIndex = newMaxIndex;
                if (currentIndex < 0) currentIndex = 0;

                const offset = -currentIndex * itemWidthPercentage;
                sliderWrapper.style.transform = `translateX(${offset}%)`;
                
                updateDots();
            };

            const goToPrev = () => {
                currentIndex = Math.max(0, currentIndex - step);
                updateSlider();
            };

            const goToNext = () => {
                const visibleItems = window.innerWidth < 768 ? 1 : 2;
                const currentMaxIndex = totalSlides > visibleItems ? totalSlides - visibleItems : 0;
                currentIndex = Math.min(currentMaxIndex, currentIndex + step);
                updateSlider();
            };

            const startAutoSlide = () => {
                stopAutoSlide(); 
                intervalId = setInterval(() => {
                    const visibleItems = window.innerWidth < 768 ? 1 : 2;
                    const currentMaxIndex = totalSlides > visibleItems ? totalSlides - visibleItems : 0;
                    
                    if (currentIndex >= currentMaxIndex) {
                        currentIndex = 0;
                    } else {
                        currentIndex += step;
                    }
                    updateSlider();
                }, 5000);
            };

            const stopAutoSlide = () => {
                clearInterval(intervalId);
            };
            
            // Función mejorada para crear dots basados en la navegación completa
            const createDots = () => {
                sliderDotsContainer.innerHTML = '';
                // Creamos un dot por cada slide
                for (let i = 0; i < totalSlides; i++) { 
                    const dot = document.createElement('button');
                    dot.classList.add('w-3', 'h-3', 'rounded-full', 'transition-colors', 'duration-300', 'bg-gray-400', 'hover:bg-indigo-500');
                    dot.setAttribute('data-index', i);
                    dot.addEventListener('click', () => {
                        currentIndex = i;
                        updateSlider();
                        stopAutoSlide();
                        setTimeout(startAutoSlide, 3000); 
                    });
                    sliderDotsContainer.appendChild(dot);
                }
                updateDots();
            };

            const updateDots = () => {
                const dots = document.querySelectorAll('#slider-dots button');
                dots.forEach((dot, index) => {
                    if (index === currentIndex) {
                        dot.classList.remove('bg-gray-400', 'hover:bg-indigo-500');
                        dot.classList.add('bg-indigo-600');
                    } else {
                        dot.classList.remove('bg-indigo-600');
                        dot.classList.add('bg-gray-400', 'hover:bg-indigo-500');
                    }
                });
            };

            const handleManualNavigation = (action) => {
                action();
                stopAutoSlide();
                setTimeout(startAutoSlide, 3000); 
            };
            
            // Manejar resize para ajustar la vista
            window.addEventListener('resize', () => {
                updateSlider();
                createDots();
            });


            prevBtn.addEventListener('click', () => handleManualNavigation(goToPrev));
            nextBtn.addEventListener('click', () => handleManualNavigation(goToNext));
            sliderMainContainer.addEventListener('mouseenter', stopAutoSlide);
            sliderMainContainer.addEventListener('mouseleave', startAutoSlide);

            createDots();
            startAutoSlide(); 
        }


        // Inicialización principal al cargar el DOM
        document.addEventListener('DOMContentLoaded', () => {
            // Inicializar Firebase y cargar reseñas
            initializeFirebase(); 

            // Lógica del Menú Móvil
            const mobileMenuButton = document.getElementById('mobile-menu-button');
            const mobileMenu = document.getElementById('mobile-menu');

            mobileMenuButton.addEventListener('click', () => {
                mobileMenu.classList.toggle('hidden');
            });
            
            document.querySelectorAll('#mobile-menu a').forEach(link => {
                link.addEventListener('click', () => {
                    mobileMenu.classList.add('hidden');
                });
            });
            
            // Inicializar Carrusel
            initCarousel(); 

            // --- LISTENERS DEL MODAL ---
            // Abrir el modal
            openModalBtn.addEventListener('click', showModal);
            openModalBtnNav.addEventListener('click', showModal);
            openModalBtnMobile.addEventListener('click', () => {
                mobileMenu.classList.add('hidden'); // Ocultar menú móvil primero
                showModal();
            });

            // Cerrar el modal
            closeModalBtn.addEventListener('click', closeModal);
            reviewModal.addEventListener('click', (e) => {
                // Cerrar si se hace clic fuera del contenido del modal
                if (e.target === reviewModal) {
                    closeModal();
                }
            });

            // Asignar el listener al formulario de reseñas
            reviewForm.addEventListener('submit', handleReviewSubmit);
        });
    </script>
</body>
</html>